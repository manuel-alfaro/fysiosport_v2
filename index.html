<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inmatning - Fysiosport Rapport</title>
    <script src="https://cdn.plot.ly/plotly-2.27.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" type="text/css"
        href="https://fonts.googleapis.com/css2?family=Avenir:wght@400&family=Futura:wght@400&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/protocols.css">
</head>

<body>

    <!-- Modals (Hardcoded duplicates removed) -->

    <div id="confirmation-modal-overlay" class="modal-overlay">
        <div class="modal-content glass-dark" style="max-width: 400px; text-align: center;">
            <h3>Bekräfta val</h3>
            <p>Vill du ladda data för <span id="confirm-patient-name" style="font-weight: bold;"></span>?</p>
            <div class="modal-actions" style="justify-content: center;">
                <button id="confirm-cancel-btn" class="modal-cancel-button">Avbryt</button>
                <button id="confirm-load-btn" class="modal-confirm-button">Ladda</button>
            </div>
        </div>
    </div>

    <aside class="app-sidebar">
        <div class="sidebar-header">
            <h2><i class="fas fa-bars"></i></h2>
        </div>
        <div>
            <div class="sidebar-buttons">
                <!-- Added Save Data button here for better UX -->
                <button id="save-data-sidebar-btn"><i class="fas fa-save"></i><span>Spara Data</span></button>

                <button id="import-data"><i class="fas fa-download"></i><span>Importera Data</span></button>
                <button id="export-data"><i class="fas fa-upload"></i><span>Exportera Data</span></button>
                <button id="clear-form"><i class="fas fa-eraser"></i><span>Töm formulär</span></button>
                <button class="nav-button active"><i class="fas fa-home"></i> Dashboard</button>
                <a href="manage_protocols.html" class="nav-button" id="manage-protocols-link"
                    style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 10px; padding: 12px 15px; border-radius: 8px; transition: all 0.3s ease; width: 100%; border: none; background: none; font-size: 1rem; cursor: pointer;"><i
                        class="fas fa-list-check"></i><span>Hantera
                        Protokoll</span></a>

                <!-- Logout Button (from previous interaction) -->
                <button id="logout-btn"><i class="fas fa-sign-out-alt"></i><span>Logga ut</span></button>
            </div>
        </div>
        <div class="sidebar-footer">
            <!-- PDF Preview removed as it was broken/not in user request? Keeping purely requested elements. -->
            <!-- User snippet HAD PDF button. Keeping it but maybe hidden or handled. -->
            <button id="pdf-preview"><i class="fas fa-file-pdf"></i><span>PDF Preview</span></button>
        </div>
    </aside>

    <main class="app-main-content">
        <div class="content-container">
            <header class="report-header-main">
                <img src="https://storage.googleapis.com/intro_alphatek/Kopi%2Bav%2BLogo%2BNegative%2Bnarrow.webp"
                    alt="Alphatek Logo" class="logo-right">
            </header>

            <!-- Persistent Top Bar for Patient Actions REMOVED -->

            <!-- NEW Workspace Actions -->
            <div class="workspace-actions">
                <button id="btn-new-patient-workspace" class="workspace-action-btn">
                    <i class="fas fa-user-plus"></i> <span class="btn-text">Ny Patient</span>
                </button>
                <button id="btn-existing-patient-workspace" class="workspace-action-btn">
                    <i class="fas fa-users"></i> <span class="btn-text">Finn Patient</span>
                </button>
            </div>

            <!-- Existing Patient Search (Hidden by default, toggles below top bar) -->
            <div id="existing-patient-search-container" style="display: none; margin-bottom: 20px;">
                <input type="text" id="patient-search-input-inline" placeholder="Sök efter namn eller ID...">
                <ul id="search-results-list-inline" style="list-style: none; padding: 0; margin-top: 10px;"></ul>
            </div>

            <!-- Active Patient Dashboard (Replaces old overview-grid) -->
            <div id="active-patient-dashboard">
                <!-- Patient Info Row: Card + Test Log Side-by-Side -->
                <div class="patient-info-row">
                    <!-- Patient Profile Card -->
                    <div id="patient-profile-section" class="patient-profile-banner">
                        <div class="patient-card">
                            <div class="patient-card-header">
                                <span class="patient-card-icon"><i class="fas fa-user-circle"></i></span>
                                <div class="patient-card-id-container">
                                    <span class="patient-card-id-label">Patient ID</span>
                                    <span class="patient-card-id" id="card-patient-id">-</span>
                                </div>
                            </div>
                            <div class="patient-card-body">
                                <div class="info-item">
                                    <span class="info-icon"><i class="fas fa-user"></i></span>
                                    <span class="label">Namn</span>
                                    <span class="value" id="card-patient-name">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-icon"><i class="fas fa-running"></i></span>
                                    <span class="label">Sport</span>
                                    <span class="value" id="card-patient-sport">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-icon"><i class="fas fa-calendar-alt"></i></span>
                                    <span class="label">Född</span>
                                    <span class="value" id="card-patient-dob">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-icon"><i class="fas fa-notes-medical"></i></span>
                                    <span class="label">Skadad Sida</span>
                                    <span class="value" id="card-patient-injured-side">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Test Log (History) -->
                    <div class="patient-card test-log-container" id="selected-patient-tests-container">
                        <h3 class="test-log-title-internal">Tidigare Tester</h3>
                        <ul id="selected-patient-tests-list" class="test-history-list">
                            <li><span>Inga tester funna</span></li>
                        </ul>
                    </div>
                </div>

                <!-- Main Form Grid (Formerly split, now just the form below) -->
                <div class="dashboard-main-content">
                    <main class="input-panel" id="form-panel-wrapper">
                        <h1 class="main-title">Testdata Inmatning</h1>
                        <input type="file" id="import-file-input" style="display: none;" accept=".xlsx">
                        <div id="main-content-forms" style="display: block;">
                            <!-- Always block inside this wrapper, visibility controlled by wrapper -->

                            <form id="input-form">
                                <h2 class="section-title-main">Testdetaljer</h2>
                                <div class="personalia-section">
                                    <div class="personalia-grid-simplified">
                                        <div class="input-group"><label for="date">Datum:</label><input type="date"
                                                id="date"></div>
                                        <div class="input-group"><label for="createdBy">Testleder:</label><input
                                                type="text" id="createdBy" placeholder="Fysioterapeut"></div>
                                    </div>
                                    <div class="dominance-section">
                                        <div class="dominance-group">
                                            <label>Referens för asymmetri:</label>
                                            <div class="radio-group">
                                                <label><input type="radio" name="dominance_type" value="dominant"
                                                        checked>
                                                    Dominant/Frisk
                                                    sida</label>
                                                <label><input type="radio" name="dominance_type" value="injured"> Skadad
                                                    sida</label>
                                            </div>
                                        </div>
                                        <!-- Side selection removed from here as it is now in patient card, logic handles implication -->
                                        <!-- Wait, dominance/injured REFERENCE logic needs to know WHICH side is dominant/injured.
                                  The Patient Card has "Injured Side".
                                  If "Dominant Side" is needed, we might need it in Patient Card too or infer it.
                                  Let's keep it simple: We need to know which side is LEFT/RIGHT for calculation.
                                  The current logic uses 'dominant_side' input.
                                  User said: "i personuppgifter kan jeg bare velge mellom om jeg skal bruke dominan eller skadet bein osm referanse ikke mer."
                                  This implies the *definition* of which leg is which is stored in the patient card.
                             -->
                                    </div>
                                </div>

                                <!-- Test Selection Screen -->
                                <div id="test-selection-container">
                                    <h2 class="section-title-main">Välj tester</h2>
                                    <p style="margin-bottom: 10px; opacity: 0.7; font-size: 0.9rem;">Välj ett sparat
                                        protokoll eller "Alla Tester" för att se allt.</p>
                                    <div class="protocol-header-controls"
                                        style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 20px;">
                                        <div class="protocol-selector-container" id="protocol-selector"
                                            style="margin-bottom: 0;">
                                            <!-- Fetched protocols will appear here -->
                                        </div>
                                    </div>
                                    <div id="test-list"></div>
                                </div>

                                <!-- Test Input Sections -->
                                <div id="test-input-container">
                                    <div class="test-section" id="test-section-balance">
                                        <h3 class="test-title">1. Balans</h3>
                                        <div class="test-row">
                                            <div class="input-column">
                                                <div class="input-container">
                                                    <div class="input-row"><label>VÄ Score:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g1_va_score"><span
                                                                class="unit-text phantom"></span></div>
                                                    </div>
                                                    <div class="input-row"><label>VÄ Gen. diff:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.01"
                                                                id="p1_g1_va_diff"><span class="unit-text">cm</span>
                                                        </div>
                                                    </div>
                                                    <hr class="input-separator">
                                                    <div class="input-row"><label>HÖ Score:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g1_ho_score"><span
                                                                class="unit-text phantom"></span></div>
                                                    </div>
                                                    <div class="input-row"><label>HÖ Gen. diff:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.01"
                                                                id="p1_g1_ho_diff"><span class="unit-text">cm</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="comment-container">
                                                    <div class="asymmetry-display" id="asymmetry_balance">
                                                    </div>
                                                    <div class="input-group"><label
                                                            for="comment_balance">Kommentar:</label><textarea
                                                            id="comment_balance"></textarea></div>
                                                </div>
                                            </div>
                                            <div class="graph-container">
                                                <h3>Balans</h3>
                                                <div id="p1-chart-balance" class="js-plotly-plot"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="test-section" id="test-section-cmj">
                                        <h3 class="test-title">2. Max Hopp CMJ</h3>
                                        <div class="test-row">
                                            <div class="input-column">
                                                <div class="input-container">
                                                    <div class="input-row"><label>VÄ Hopp 1:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g2_va_1"><span class="unit-text">cm</span></div>
                                                    </div>
                                                    <div class="input-row"><label>VÄ Hopp 2:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g2_va_2"><span class="unit-text">cm</span></div>
                                                    </div>
                                                    <div class="input-row"><label>VÄ Hopp 3:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g2_va_3"><span class="unit-text">cm</span></div>
                                                    </div>
                                                    <hr class="input-separator">
                                                    <div class="input-row"><label>HÖ Hopp 1:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g2_ho_1"><span class="unit-text">cm</span></div>
                                                    </div>
                                                    <div class="input-row"><label>HÖ Hopp 2:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g2_ho_2"><span class="unit-text">cm</span></div>
                                                    </div>
                                                    <div class="input-row"><label>HÖ Hopp 3:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g2_ho_3"><span class="unit-text">cm</span></div>
                                                    </div>
                                                </div>
                                                <div class="comment-container">
                                                    <div class="asymmetry-display" id="asymmetry_cmj"></div>
                                                    <div class="input-group"><label
                                                            for="comment_cmj">Kommentar:</label><textarea
                                                            id="comment_cmj"></textarea></div>
                                                </div>
                                            </div>
                                            <div class="graph-container">
                                                <h3>Max Hopp CMJ</h3>
                                                <div id="p1-chart-cmj" class="js-plotly-plot"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="test-section" id="test-section-tia">
                                        <h3 class="test-title">3. Repeterade Hopp (TIA)</h3>
                                        <div class="test-row">
                                            <div class="input-column">
                                                <div class="input-container">
                                                    <div class="input-row"><label>VÄ Gen. hopphöjd:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p1_g3_va_jump"><span class="unit-text">cm</span>
                                                        </div>
                                                    </div>
                                                    <div class="input-row"><label>VÄ GCT:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.01"
                                                                id="p1_g3_va_gct"><span class="unit-text">s</span></div>
                                                    </div>
                                                    <hr class="input-separator">
                                                    <div class="input-row"><label>HÖ Gen. hopphöjd:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p1_g3_ho_jump"><span class="unit-text">cm</span>
                                                        </div>
                                                    </div>
                                                    <div class="input-row"><label>HÖ GCT:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.01"
                                                                id="p1_g3_ho_gct"><span class="unit-text">s</span></div>
                                                    </div>
                                                </div>
                                                <div class="comment-container">
                                                    <div class="asymmetry-display" id="asymmetry_tia"></div>
                                                    <div class="input-group"><label
                                                            for="comment_tia">Kommentar:</label><textarea
                                                            id="comment_tia"></textarea></div>
                                                </div>
                                            </div>
                                            <div class="graph-container">
                                                <h3>Repeterade Hopp (TIA)</h3>
                                                <div id="p1-chart-tia" class="js-plotly-plot"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="test-section" id="test-section-sidehop">
                                        <h3 class="test-title">4. Sidhopp (TIA)</h3>
                                        <div class="test-row">
                                            <div class="input-column">
                                                <div class="input-container">
                                                    <div class="input-row"><label>VÄ Antal:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g4_va_count"><span class="unit-text">st</span>
                                                        </div>
                                                    </div>
                                                    <hr class="input-separator">
                                                    <div class="input-row"><label>HÖ Antal:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g4_ho_count"><span class="unit-text">st</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="comment-container">
                                                    <div class="asymmetry-display" id="asymmetry_sidehop">
                                                    </div>
                                                    <div class="input-group"><label
                                                            for="comment_sidehop">Kommentar:</label><textarea
                                                            id="comment_sidehop"></textarea></div>
                                                </div>
                                            </div>
                                            <div class="graph-container">
                                                <h3>Sidhopp (TIA)</h3>
                                                <div id="p1-chart-sidehop" class="js-plotly-plot"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="test-section" id="test-section-squat">
                                        <h3 class="test-title">5. Squat Analytics</h3>
                                        <div class="test-row">
                                            <div class="input-column">
                                                <div class="input-container">
                                                    <div class="input-row"><label>Försök 1:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g5_attempt_1"><span class="unit-text">%</span>
                                                        </div>
                                                    </div>
                                                    <div class="input-row"><label>Försök 2:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g5_attempt_2"><span class="unit-text">%</span>
                                                        </div>
                                                    </div>
                                                    <div class="input-row"><label>Försök 3:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g5_attempt_3"><span class="unit-text">%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="comment-container">
                                                    <div class="input-group"><label
                                                            for="comment_squat">Kommentar:</label><textarea
                                                            id="comment_squat"></textarea></div>
                                                </div>
                                            </div>
                                            <div class="graph-container">
                                                <h3>Squat Analytics</h3>
                                                <div id="donut-container">
                                                    <div class="donut-wrapper">
                                                        <div id="p1-chart-donut-1" class="js-plotly-plot">
                                                        </div>
                                                        <p class="donut-label">Försök 1</p>
                                                    </div>
                                                    <div class="donut-wrapper">
                                                        <div id="p1-chart-donut-2" class="js-plotly-plot">
                                                        </div>
                                                        <p class="donut-label">Försök 2</p>
                                                    </div>
                                                    <div class="donut-wrapper">
                                                        <div id="p1-chart-donut-3" class="js-plotly-plot">
                                                        </div>
                                                        <p class="donut-label">Försök 3</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="test-section" id="test-section-repeated_bilateral">
                                        <h3 class="test-title">6. Repeated Jumps (Två Ben)</h3>
                                        <div class="test-row">
                                            <div class="input-column">
                                                <div class="input-container">
                                                    <div class="input-row"><label>Gen. hopphöjd:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p1_g6_avg_height"><span class="unit-text">cm</span>
                                                        </div>
                                                    </div>
                                                    <div class="input-row"><label>Gen. GCT:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.01"
                                                                id="p1_g6_avg_gct"><span class="unit-text">s</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="comment-container">
                                                    <div class="input-group"><label
                                                            for="comment_repeated_bilateral">Kommentar:</label><textarea
                                                            id="comment_repeated_bilateral"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="graph-container">
                                                <h3>Repeated Jumps (Två Ben)</h3>
                                                <div id="p1-chart-repeated-bilateral" class="js-plotly-plot"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="test-section" id="test-section-cmj2ben">
                                        <h3 class="test-title">7. CMJ (TOV) Två Ben</h3>
                                        <div class="test-row">
                                            <div class="input-column">
                                                <div class="input-container">
                                                    <div class="input-row"><label>Försök 1:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g7_attempt_1"><span class="unit-text">cm</span>
                                                        </div>
                                                    </div>
                                                    <div class="input-row"><label>Försök 2:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g7_attempt_2"><span class="unit-text">cm</span>
                                                        </div>
                                                    </div>
                                                    <div class="input-row"><label>Försök 3:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p1_g7_attempt_3"><span class="unit-text">cm</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="comment-container">
                                                    <div class="input-group"><label
                                                            for="comment_cmj2ben">Kommentar:</label><textarea
                                                            id="comment_cmj2ben"></textarea></div>
                                                </div>
                                            </div>
                                            <div class="graph-container">
                                                <h3>CMJ (TOV) Två Ben</h3>
                                                <div id="donut-container-cmj2ben">
                                                    <div class="donut-wrapper">
                                                        <div id="p1-chart-donut-cmj2ben-1" class="js-plotly-plot"></div>
                                                        <p class="donut-label">Försök 1</p>
                                                    </div>
                                                    <div class="donut-wrapper">
                                                        <div id="p1-chart-donut-cmj2ben-2" class="js-plotly-plot"></div>
                                                        <p class="donut-label">Försök 2</p>
                                                    </div>
                                                    <div class="donut-wrapper">
                                                        <div id="p1-chart-donut-cmj2ben-3" class="js-plotly-plot"></div>
                                                        <p class="donut-label">Försök 3</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="test-section" id="test-section-hipthrust">
                                        <h3 class="test-title">8. Hip Thrusters Pull</h3>
                                        <div class="test-row">
                                            <div class="input-column">
                                                <div class="input-container">
                                                    <div class="input-row"><label>Hip Thrust VÄ:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p2_g1_va"><span class="unit-text">kg</span></div>
                                                    </div>
                                                    <div class="input-row"><label>Hip Thrust HÖ:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p2_g1_ho"><span class="unit-text">kg</span></div>
                                                    </div>
                                                    <hr class="input-separator">
                                                    <div class="input-row"><label>Två ben (Djur):</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p2_g1_tva"><span class="unit-text">kg</span></div>
                                                    </div>
                                                </div>
                                                <div class="comment-container">
                                                    <div class="asymmetry-display" id="asymmetry_hipthrust">
                                                    </div>
                                                    <div class="input-group"><label
                                                            for="comment_hipthrust">Kommentar:</label><textarea
                                                            id="comment_hipthrust"></textarea></div>
                                                </div>
                                            </div>
                                            <div class="graph-container">
                                                <h3>Hip Thrusters Pull</h3>
                                                <div id="p2-chart-hipthrust" class="js-plotly-plot"></div>
                                                <img id="overlay-image-hipthrust" src="" class="graph-overlay-image"
                                                    alt="Animal">
                                                <div id="overlay-text-hipthrust" class="graph-overlay-text">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="test-section" id="test-section-quads">
                                        <h3 class="test-title">9. Quadriceps Isometrisk Styrka</h3>
                                        <div class="test-row">
                                            <div class="input-column">
                                                <div class="input-container">
                                                    <div class="input-row"><label>Quadriceps VÄ:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p2_g2_va"><span class="unit-text">kg</span></div>
                                                    </div>
                                                    <hr class="input-separator">
                                                    <div class="input-row"><label>Quadriceps HÖ:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p2_g2_ho"><span class="unit-text">kg</span></div>
                                                    </div>
                                                </div>
                                                <div class="comment-container">
                                                    <div class="asymmetry-display" id="asymmetry_quads">
                                                    </div>
                                                    <div class="input-group"><label
                                                            for="comment_quads">Kommentar:</label><textarea
                                                            id="comment_quads"></textarea></div>
                                                </div>
                                            </div>
                                            <div class="graph-container">
                                                <h3>Quadriceps Isometrisk Styrka</h3>
                                                <div id="p2-chart-quads" class="js-plotly-plot"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="test-section" id="test-section-staticsquat-handdrag">
                                        <h3 class="test-title">10. Static Squat Pull - Handdrag</h3>
                                        <div class="test-row">
                                            <div class="input-column">
                                                <div class="input-container">
                                                    <div class="input-row"><label>VÄ:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p2_g3_va"><span class="unit-text">kg</span></div>
                                                    </div>
                                                    <div class="input-row"><label>HÖ:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p2_g3_ho"><span class="unit-text">kg</span></div>
                                                    </div>
                                                    <hr class="input-separator">
                                                    <div class="input-row"><label>Två ben (Djur):</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p2_g3_tva"><span class="unit-text">kg</span></div>
                                                    </div>
                                                </div>
                                                <div class="comment-container">
                                                    <div class="asymmetry-display" id="asymmetry_squat_pull_handdrag">
                                                    </div>
                                                    <div class="input-group"><label
                                                            for="comment_squat_pull_handdrag">Kommentar:</label><textarea
                                                            id="comment_squat_pull_handdrag"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="graph-container">
                                                <h3>Static Squat Pull - Handdrag</h3>
                                                <div id="p2-chart-squat-handdrag" class="js-plotly-plot">
                                                </div>
                                                <img id="overlay-image-squat-handdrag" src=""
                                                    class="graph-overlay-image" alt="Animal">
                                                <div id="overlay-text-squat-handdrag" class="graph-overlay-text"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="test-section" id="test-section-staticsquat-hoftrem">
                                        <h3 class="test-title">11. Static Squat Pull - Höftrem</h3>
                                        <div class="test-row">
                                            <div class="input-column">
                                                <div class="input-container">
                                                    <div class="input-row"><label>VÄ:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p2_g4_va"><span class="unit-text">kg</span></div>
                                                    </div>
                                                    <div class="input-row"><label>HÖ:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p2_g4_ho"><span class="unit-text">kg</span></div>
                                                    </div>
                                                    <hr class="input-separator">
                                                    <div class="input-row"><label>Två ben (Djur):</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p2_g4_tva"><span class="unit-text">kg</span></div>
                                                    </div>
                                                </div>
                                                <div class="comment-container">
                                                    <div class="asymmetry-display" id="asymmetry_squat_pull_hoftrem">
                                                    </div>
                                                    <div class="input-group"><label
                                                            for="comment_squat_pull_hoftrem">Kommentar:</label><textarea
                                                            id="comment_squat_pull_hoftrem"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="graph-container">
                                                <h3>Static Squat Pull - Höftrem</h3>
                                                <div id="p2-chart-squat-hoftrem" class="js-plotly-plot">
                                                </div>
                                                <img id="overlay-image-squat-hoftrem" src="" class="graph-overlay-image"
                                                    alt="Animal">
                                                <div id="overlay-text-squat-hoftrem" class="graph-overlay-text"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="test-section" id="test-section-hamstring">
                                        <h3 class="test-title">12. Hamstring Isometrisk Styrka</h3>
                                        <div class="test-row">
                                            <div class="input-column">
                                                <div class="input-container">
                                                    <div class="input-row"><label>Hamstring VÄ:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p2_g5_va"><span class="unit-text">N</span></div>
                                                    </div>
                                                    <hr class="input-separator">
                                                    <div class="input-row"><label>Hamstring HÖ:</label>
                                                        <div class="input-wrapper"><input type="number" step="0.1"
                                                                id="p2_g5_ho"><span class="unit-text">N</span></div>
                                                    </div>
                                                </div>
                                                <div class="comment-container">
                                                    <div class="asymmetry-display" id="asymmetry_hamstring">
                                                    </div>
                                                    <div class="input-group"><label
                                                            for="comment_hamstring">Kommentar:</label><textarea
                                                            id="comment_hamstring"></textarea></div>
                                                </div>
                                            </div>
                                            <div class="graph-container">
                                                <h3>Hamstring Isometrisk Styrka</h3>
                                                <div id="p2-chart-hamstring" class="js-plotly-plot"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="test-section" id="test-section-nordic-hamstring">
                                        <h3 class="test-title">13. Nordic Hamstrings</h3>
                                        <div class="test-row">
                                            <div class="input-column">
                                                <div class="input-container">
                                                    <div class="input-row"><label>Försök 1:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p2_g6_attempt_1"><span class="unit-text">N</span>
                                                        </div>
                                                    </div>
                                                    <div class="input-row"><label>Försök 2:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p2_g6_attempt_2"><span class="unit-text">N</span>
                                                        </div>
                                                    </div>
                                                    <div class="input-row"><label>Försök 3:</label>
                                                        <div class="input-wrapper"><input type="number"
                                                                id="p2_g6_attempt_3"><span class="unit-text">N</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="comment-container">
                                                    <div class="input-group"><label
                                                            for="comment_nordic_hamstring">Kommentar:</label><textarea
                                                            id="comment_nordic_hamstring"></textarea></div>
                                                </div>
                                            </div>
                                            <div class="graph-container">
                                                <h3>Nordic Hamstrings</h3>
                                                <div id="donut-container-nordic">
                                                    <div class="donut-wrapper">
                                                        <div id="p2-chart-donut-nordic-1" class="js-plotly-plot"></div>
                                                        <p class="donut-label">Försök 1</p>
                                                    </div>
                                                    <div class="donut-wrapper">
                                                        <div id="p2-chart-donut-nordic-2" class="js-plotly-plot"></div>
                                                        <p class="donut-label">Försök 2</p>
                                                    </div>
                                                    <div class="donut-wrapper">
                                                        <div id="p2-chart-donut-nordic-3" class="js-plotly-plot"></div>
                                                        <p class="donut-label">Försök 3</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="test-section" id="test-section-manual">
                                        <h3 class="test-title">14. Manuella Mätningar</h3>
                                        <div class="test-row">
                                            <div class="input-column">
                                                <div class="input-container">
                                                    <div class="manual-measurements-grid">
                                                        <div class="manual-box">
                                                            <h4>Static Row Pull</h4>
                                                            <div class="input-group"><label>Tare
                                                                    (N):</label><input type="number"
                                                                    id="p2_text_srp_tare"></div>
                                                            <div class="input-group"><label>Force
                                                                    (N):</label><input type="number"
                                                                    id="p2_text_srp_force"></div>
                                                        </div>
                                                        <div class="manual-box">
                                                            <h4>Squat Power to Speed</h4>
                                                            <div class="input-group"><label>Vikt
                                                                    (kg):</label><input type="number"
                                                                    id="p2_text_spts_kg"></div>
                                                        </div>
                                                        <div class="manual-box">
                                                            <h4>Max Press Push Up</h4>
                                                            <div class="input-group"><label>Tare
                                                                    (N):</label><input type="number"
                                                                    id="p2_text_mpu_tare"></div>
                                                            <div class="input-group"><label>Force
                                                                    (N):</label><input type="number"
                                                                    id="p2_text_mpu_force"></div>
                                                        </div>
                                                        <div class="manual-box">
                                                            <h4>Blaze Pod Challenge</h4>
                                                            <div class="input-group"><label>Antal
                                                                    träffar:</label><input type="number"
                                                                    id="p2_text_bpc_hits"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="graph-container">
                                                <h3>Manuella Mätningar</h3>
                                                <div id="manual-preview-content"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </div>
                        </form>
                </div>
    </main> <!-- End input-panel -->
    </div> <!-- End dashboard-grid -->
    </div> <!-- End active-patient-dashboard -->
    </div> <!-- End content-container -->

    <!-- Protocol Management View (Full Page) -->
    <!-- Protocol Management View removed (moved to manage_protocols.html) -->

    </main>

    <!-- Patient Modal (Create) -->
    <div id="patient-modal-overlay" class="modal-overlay" style="display: none;">
        <div id="patient-modal-content" class="modal-content glass-dark"></div>
    </div>

    <!-- Patient Search Modal (Existing) -->
    <div id="search-modal-overlay" class="modal-overlay" style="display: none;">
        <div class="modal-content glass-dark" style="width: 100%; max-width: 500px;">
            <h3>Sök Patient</h3>
            <input type="text" id="patient-search-input-modal" placeholder="Sök efter namn eller ID...">
            <ul id="search-results-list-modal" style="list-style: none; padding: 0; margin-top: 10px;">
            </ul>
            <div class="modal-actions">
                <button class="modal-cancel-button" id="close-search-modal">Stäng</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/utils.js"></script>
    <script type="module" src="js/index.js?v=FIXED_LAYOUT_19"></script>
</body>

</html>